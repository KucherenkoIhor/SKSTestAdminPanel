<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" th:inline="javascript">
        /*<![CDATA[*/

        google.charts.load('current', {'packages':['corechart']});

        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {

            var results = [[${results}]];

            var columns = [];
            var rows = [];
            var years = [];

            var data = new google.visualization.DataTable();

            data.addColumn('string', 'Год');

            var i;
            for (i = 0; i < results.length; i++) {
                if(columns.indexOf(results[i].groupName) == -1) {
                    columns.push(results[i].groupName);
                }
            }
            for (i = 0; i < columns.length; i++) {
                data.addColumn('number', columns[i]);
            }
            for (i = 0; i < results.length; i++) {
                if(years.indexOf(results[i].year) == -1) {
                    years.push(results[i].year);
                }
            }
            for (i = 0; i < years.length; i++) {
                var row = [];
                row[0] = years[i];
                console.log(years[i]);
                for (var j = 0; j < results.length; j++) {
                    if(results[j].year == years[i]) {
                        for(var k = 0; k < columns.length; k ++) {
                            if (results[j].groupName == columns[k]) {
                                console.log('group: ' + columns[k] + ' value: ' + results[j].value);
                                row[k + 1] = results[j].value;
                            }
                            if (row[k + 1] === undefined || row[k + 1] === null) {
                                row[k + 1] = 0;
                            }
                            if(rows.indexOf(row) == -1) {
                                rows.push(row);
                            }
                        }
                    }
                }
            }

            columns.forEach(function (item) {
                console.log(item);
            })

            for (i = 0; i < rows.length; i++) {
                console.log(rows[i]);
                data.addRow(rows[i]);
            }

            var chart = new google.visualization.LineChart(document.getElementById('chart_div'));

            chart.draw(data, {width: 1000, height: 600});

        }
        /*]]>*/
    </script>
</head>
<body>
<!--Div that will hold the pie chart-->
    <div id="chart_div"></div>
</body>
</html>